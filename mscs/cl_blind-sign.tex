\begin{msc}{}

\fontfamily{\rmdefault}

\setlength{\instwidth}{1.5\instwidth}
\setlength{\instdist}{14cm}
\setlength{\envinstdist}{2\envinstdist}
\setlength{\referenceoverlap}{6cm}

\declinst{R}{}{Receiver}
\declinst{S}{}{Signer}

\action*{%
  $v' \in_R \{0,1\}^{l_n+l_\emptyset}$\\ 
  $U \leftarrow S^{v'} \prod_{i=1}^{L'} R_i^{m_i} \mod n$%
}{R}
\nextlevel[3.2]

\mess{$U$}{R}{S}
\nextlevel[.5]

\referencestart{PK}{%
  $PK\{(\mu_1, \dots, \mu_{L'}, \nu') : 
    U \equiv \pm S^{\nu'} \prod_{i=1}^{L'} R_i^{\mu_i} \mod n \;\land\; \mu_1, \dots, \mu_{L'} \in \pm\{0,1\}^{l_m} \}$%
}{R}{S}
\nextlevel[1.8]
\referenceend{PK}
\nextlevel[.5]

\action*{%
  $\hat{v} \in_R \{0,1\}^{l_v-1}$\\
  $e \in_R [2^{l_e-1} + 1, 2^{l_e} -1]$\\
  $v'' \leftarrow \hat{v} + 2^{l_v - 1}$\\
  $A \leftarrow \left(\dfrac{Z}{U S^{v''}\prod_{i=L'+1}^{L} R_i^{m_i}} \right)^{1/e} \mod n$%
}{S}
\nextlevel[5.8]

\mess{$(e, v'', A)$}{S}{R}
\nextlevel[.5]

\referencestart{PK2}{%
  $PK\{(\delta) : 
  A \equiv \pm \left(\dfrac{Z}{U S^{v''} \prod_{i=L'+1}^{L} R_i^{m_i}} \right)^{\delta} \mod n \}$%
}{R}{S}
\nextlevel[2.8]
\referenceend{PK2}
\nextlevel[.5]

\action*{%
  verify $e \in [2^{l_e-1} + 1, 2^{l_e} -1]$ is prime\\
  $v \leftarrow v' + v''$%
}{R}
\nextlevel[2]

\end{msc}
