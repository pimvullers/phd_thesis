\begin{msc}{}

\setlength{\instwidth}{1.5\instwidth}

\declinst{P}{$h = g_1^{x_1} g_2^{x_2}$, $\tilde{h} = \tilde{g}_1^{x_1} \tilde{g}_2^{x_3}$}{Prover}
\declinst{V}{$g_1$, $g_2$, $\tilde{g}_1$, $\tilde{g}_2$, $h$, $\tilde{h}$}{Verifier}

\action*{%
  $u_1, u_2, u_3 \in_R \mathbb{Z}_p$\\ 
  $a_1 \leftarrow g_1^{u_1} g_2^{u_2}$\\ 
  $a_2 \leftarrow \tilde{g}_1^{u_1}\tilde{g}_1^{u_3}$%
}{P}
\nextlevel[3.2]

\mess{$a_1, a_2$}{P}{V}
\nextlevel[.5]

\action*{%
  $c \in_R \mathbb{Z}_p$%
}{V}
\nextlevel[1.5]

\mess{$c$}{V}{P}
\nextlevel[.5]

\action*{%
  $r_1 \leftarrow_p u_1 + cx_1$\\ 
  $r_2 \leftarrow_p u_2 + cx_2$\\
  $r_3 \leftarrow_p u_3 + cx_3$%
}{P}
\nextlevel[3.2]

\mess{$r_1, r_2, r_3$}{P}{V}
\nextlevel[.5]

\action*{%
  $g_1^{r_1} g_2^{r_2} \stackrel{?}{=} a_1 h^c$\\
  $\tilde{g}_1^{r_1} \tilde{g}_2^{r_3} \stackrel{?}{=} a_2 \tilde{h}^c$%
}{V}
\nextlevel[2.5]

\end{msc}
